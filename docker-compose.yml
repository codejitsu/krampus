version: '2'

services:
    ########### CORE #################

    #TODO add 3 kafka node cluster
    kafka:
        extends:
            file: base-containers.yml
            service: kafka-base

    statsd:
        extends:
            file: base-containers.yml
            service: grafana-base
        volumes:
            - ./compose-resources/grafana/dashboards:/src/dashboards/

    ########### COMPONENTS ###########

    krampus-source:
        image: codejitsu/krampus-source:0.1-SNAPSHOT
        depends_on:
            - kafka
        volumes:
            - /tmp/share:/tmp/share
        stdin_open: true
        restart: always

    krampus-producer:
        image: codejitsu/krampus-producer:0.1-SNAPSHOT
        depends_on:
            - kafka
            - krampus-source
        volumes:
            - /tmp/share:/tmp/share
        stdin_open: true
        links:
            - kafka:kafka
        restart: always

    krampus-metrics-aggregator:
        image: codejitsu/krampus-metrics-aggregator:0.1-SNAPSHOT
        depends_on:
            - kafka
            - statsd
        links:
            - kafka:kafka
        restart: always
